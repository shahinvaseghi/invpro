{% extends "inventory/base.html" %}
{% load i18n %}

{% block page_title %}نتیجه وارد کردن کالاها{% endblock %}

{% block inventory_content %}
<div class="form-container">
  <h2>نتیجه وارد کردن کالاها از فایل Excel</h2>
  
  <div style="margin: 2rem 0;">
    <div class="alert alert-success" style="background-color: #d1fae5; border-color: #10b981; color: #065f46; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
      <strong>موفق:</strong> {{ success_count }} کالا با موفقیت وارد شد.
    </div>
    
    {% if error_count > 0 %}
    <div class="alert alert-error" style="background-color: #fee2e2; border-color: #ef4444; color: #991b1b; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
      <strong>خطا:</strong> {{ error_count }} ردیف دارای خطا بودند.
    </div>
    {% endif %}
    
    <div style="margin-top: 1rem;">
      <p><strong>تعداد کل ردیف‌ها:</strong> {{ total_rows }}</p>
      <p><strong>موفق:</strong> {{ success_count }}</p>
      <p><strong>خطا:</strong> {{ error_count }}</p>
    </div>
  </div>
  
  {% if errors %}
  <div style="margin-top: 2rem;">
    <h3>ردیف‌های دارای خطا:</h3>
    <div style="overflow-x: auto; margin-top: 1rem;">
      <table class="data-table" style="width: 100%;">
        <thead>
          <tr>
            <th>ردیف</th>
            <th>خطاها</th>
            <th>داده‌های ردیف (10 ستون اول)</th>
          </tr>
        </thead>
        <tbody>
          {% for error in errors %}
          <tr>
            <td><strong>{{ error.row }}</strong></td>
            <td>
              <ul style="margin: 0; padding-right: 1.5rem; color: #dc2626;">
                {% for err_msg in error.errors %}
                <li>{{ err_msg }}</li>
                {% endfor %}
              </ul>
            </td>
            <td>
              <code style="font-size: 0.875rem;">
                {{ error.data|join:" | "|truncatewords:20 }}
              </code>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
  
  <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
    <a href="{% url 'inventory:items' %}" class="btn btn-primary">بازگشت به فهرست کالاها</a>
    <a href="{% url 'inventory:item_excel_template' %}" class="btn btn-secondary">دانلود مجدد فایل نمونه</a>
  </div>
</div>
{% endblock %}


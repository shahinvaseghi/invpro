{% extends "shared/generic/generic_list.html" %}
{% load i18n %}
{% load access_tags %}

{% block breadcrumb_extra %}
<span class="separator">/</span>
<span>{% trans "Items" %}</span>
{% endblock %}

{% block page_actions %}
<div class="page-actions">
  {% if create_url %}
    <a href="{{ create_url }}" class="btn btn-primary">
      + {{ create_button_text|default:"Create New" }}
    </a>
  {% endif %}
  {% if user_feature_permissions|feature_allowed:'inventory.master.item_types' %}
    <a href="{% url 'inventory:item_types' %}" class="btn btn-secondary">
      {% trans "Item Types" %}
    </a>
  {% endif %}
  {% if user_feature_permissions|feature_allowed:'inventory.master.item_categories' %}
    <a href="{% url 'inventory:item_categories' %}" class="btn btn-secondary">
      {% trans "Item Categories" %}
    </a>
  {% endif %}
  {% if user_feature_permissions|feature_allowed:'inventory.master.item_subcategories' %}
    <a href="{% url 'inventory:item_subcategories' %}" class="btn btn-secondary">
      {% trans "Item Subcategories" %}
    </a>
  {% endif %}
  <a href="{% url 'inventory:item_excel_template' %}" class="btn btn-secondary">
    ðŸ“¥ {% trans "Download Excel Template" %}
  </a>
  <button type="button" class="btn btn-secondary" data-toggle="excel-import-form" data-display="block">
    ðŸ“¤ {% trans "Import Items from Excel" %}
  </button>
  {% if print_enabled %}
    <button class="btn btn-secondary btn-print" data-action="print">
      {% trans "Print" %}
    </button>
  {% endif %}
</div>

<!-- Excel Import Form (hidden by default) -->
<div id="excel-import-form" style="display: none; margin-top: 1rem; padding: 1.5rem; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px;">
  <h3 style="margin-bottom: 1rem;">{% trans "Import Items from Excel" %}</h3>
  <form method="post" action="{% url 'inventory:item_excel_import' %}" enctype="multipart/form-data">
    {% csrf_token %}
    <div style="display: flex; gap: 1rem; align-items: flex-end;">
      <div style="flex: 1;">
        <label for="excel_file" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">{% trans "Select Excel File" %}:</label>
        <input type="file" name="excel_file" id="excel_file" accept=".xlsx,.xls" required style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px;">
      </div>
      <button type="submit" class="btn btn-primary">{% trans "Upload and Import" %}</button>
      <button type="button" onclick="document.getElementById('excel-import-form').style.display='none'" class="btn btn-secondary">{% trans "Cancel" %}</button>
    </div>
    <p style="margin-top: 0.5rem; color: #6b7280; font-size: 0.875rem;">
      {% trans "Please fill the Excel file according to the downloaded template." %}
    </p>
  </form>
</div>
{% endblock %}

{% block filter_fields %}
<div class="form-group">
  <label for="search">{% trans "Search" %}</label>
  <input type="text" name="search" id="search" 
         placeholder="{% trans "Search by code or name" %}" 
         value="{{ request.GET.search }}"
         class="form-control">
</div>

<div class="form-group">
  <label for="type">{% trans "Item Type" %}</label>
  <select name="type" id="type" class="form-control">
    <option value="">-- {% trans "All Types" %} --</option>
    {% for item_type in item_types %}
    <option value="{{ item_type.id }}" {% if request.GET.type == item_type.id|stringformat:"s" %}selected{% endif %}>{{ item_type.name }}</option>
    {% endfor %}
  </select>
</div>

<div class="form-group">
  <label for="category">{% trans "Category" %}</label>
  <select name="category" id="category" class="form-control">
    <option value="">-- {% trans "All Categories" %} --</option>
    {% for category in item_categories %}
    <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
    {% endfor %}
  </select>
</div>

{% if status_filter %}
<div class="form-group">
  <label for="status">{% trans "Status" %}</label>
  <select name="status" id="status" class="form-control">
    <option value="">-- {% trans "All" %} --</option>
    <option value="1" {% if request.GET.status == '1' %}selected{% endif %}>{% trans "Active" %}</option>
    <option value="0" {% if request.GET.status == '0' %}selected{% endif %}>{% trans "Inactive" %}</option>
  </select>
</div>
{% endif %}
{% endblock %}

{% block table_headers %}
<th>{% trans "Item Code" %}</th>
<th>{% trans "Item Name" %}</th>
<th>{% trans "Type" %}</th>
<th>{% trans "Category" %}</th>
<th>{% trans "Batch Number" %}</th>
<th>{% trans "Lot Tracking" %}</th>
<th>{% trans "Status" %}</th>
{% if show_actions %}
  <th>{% trans "Actions" %}</th>
{% endif %}
{% endblock %}

{% block table_rows %}
{% for item in object_list %}
<tr>
  <td><code>{{ item.item_code }}</code></td>
  <td><strong>{{ item.name }}</strong>{% if item.name_en %}<br><small style="color: #6b7280;">{{ item.name_en }}</small>{% endif %}</td>
  <td>{{ item.type.name }}</td>
  <td>{{ item.category.name }}</td>
  <td><code>{{ item.batch_number|default:"-" }}</code></td>
  <td>
    {% if item.has_lot_tracking %}
      <span class="badge badge-active">{% trans "Tracked" %}</span>
    {% else %}
      <span class="badge badge-inactive">{% trans "Not Tracked" %}</span>
    {% endif %}
  </td>
  <td>
    {% if item.is_enabled %}
      <span class="badge badge-active">{% trans "Active" %}</span>
    {% else %}
      <span class="badge badge-inactive">{% trans "Inactive" %}</span>
    {% endif %}
  </td>
  {% if show_actions %}
  <td>
    {% include 'shared/partials/row_actions.html' with object=item feature_code=feature_code detail_url_name=detail_url_name edit_url_name=edit_url_name delete_url_name=delete_url_name %}
  </td>
  {% endif %}
</tr>
{% endfor %}
{% endblock %}

{% block empty_state_title %}{% trans "No Items Found" %}{% endblock %}
{% block empty_state_message %}{% trans "Start by creating your first item." %}{% endblock %}
{% block empty_state_icon %}ðŸ“¦{% endblock %}

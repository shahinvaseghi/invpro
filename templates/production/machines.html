{% extends "shared/generic/generic_list.html" %}
{% load i18n %}

{% block filter_fields %}
<div class="form-group">
  <label for="search">{% trans "Search" %}</label>
  <input type="text" id="search" name="search" 
         placeholder="{{ search_placeholder|default:'Search by code or name' }}" 
         value="{{ request.GET.search }}"
         class="form-control">
</div>
<div class="form-group">
  <label for="work_center">{% trans "Work Center" %}</label>
  <select id="work_center" name="work_center" class="form-control">
    <option value="">-- {% trans "All" %} --</option>
    {% for wc in work_centers %}
      <option value="{{ wc.id }}" {% if request.GET.work_center == wc.id|stringformat:"s" %}selected{% endif %}>{{ wc.name }}</option>
    {% endfor %}
  </select>
</div>
<div class="form-group">
  <label for="status">{% trans "Status" %}</label>
  <select id="status" name="status" class="form-control">
    <option value="">-- {% trans "All" %} --</option>
    <option value="operational" {% if request.GET.status == "operational" %}selected{% endif %}>{% trans "Operational" %}</option>
    <option value="maintenance" {% if request.GET.status == "maintenance" %}selected{% endif %}>{% trans "Maintenance" %}</option>
    <option value="idle" {% if request.GET.status == "idle" %}selected{% endif %}>{% trans "Idle" %}</option>
    <option value="broken" {% if request.GET.status == "broken" %}selected{% endif %}>{% trans "Broken" %}</option>
    <option value="retired" {% if request.GET.status == "retired" %}selected{% endif %}>{% trans "Retired" %}</option>
  </select>
</div>
{% endblock %}

{% block table_headers %}
<th>{% trans "Code" %}</th>
<th>{% trans "Name" %}</th>
<th>{% trans "Name (English)" %}</th>
<th>{% trans "Type" %}</th>
<th>{% trans "Work Center" %}</th>
<th>{% trans "Status" %}</th>
{% if show_actions %}
  <th>{% trans "Actions" %}</th>
{% endif %}
{% endblock %}

{% block table_rows %}
{% for machine in object_list %}
<tr>
  <td><code>{{ machine.public_code }}</code></td>
  <td><strong>{{ machine.name }}</strong></td>
  <td>{{ machine.name_en|default:"–" }}</td>
  <td>{{ machine.machine_type }}</td>
  <td>
    {% if machine.work_center %}
      {{ machine.work_center.name }}
    {% else %}
      <span class="muted-text">–</span>
    {% endif %}
  </td>
  <td>
    {% if machine.status == "operational" %}
      <span class="badge badge-active">{% trans "Operational" %}</span>
    {% elif machine.status == "maintenance" %}
      <span class="badge badge-warning">{% trans "Maintenance" %}</span>
    {% elif machine.status == "idle" %}
      <span class="badge badge-info">{% trans "Idle" %}</span>
    {% elif machine.status == "broken" %}
      <span class="badge badge-danger">{% trans "Broken" %}</span>
    {% elif machine.status == "retired" %}
      <span class="badge badge-inactive">{% trans "Retired" %}</span>
    {% else %}
      <span class="badge badge-inactive">{{ machine.status }}</span>
    {% endif %}
  </td>
  {% if show_actions %}
  <td>
    <a href="{% url edit_url_name machine.pk %}" class="btn btn-secondary" style="padding: 4px 12px; font-size: 0.85rem;">
      {% trans "Edit" %}
    </a>
    <a href="{% url delete_url_name machine.pk %}" class="btn btn-primary" style="padding: 4px 12px; font-size: 0.85rem;">
      {% trans "Delete" %}
    </a>
  </td>
  {% endif %}
</tr>
{% endfor %}
{% endblock %}

{% block pagination %}
{% if is_paginated %}
<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.work_center %}&work_center={{ request.GET.work_center }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">&laquo; {% trans "First" %}</a>
    <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.work_center %}&work_center={{ request.GET.work_center }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">{% trans "Previous" %}</a>
  {% endif %}

  <span class="current">
    {% trans "Page" %} {{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}
  </span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.work_center %}&work_center={{ request.GET.work_center }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">{% trans "Next" %}</a>
    <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.work_center %}&work_center={{ request.GET.work_center }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">{% trans "Last" %} &raquo;</a>
  {% endif %}
</div>
{% endif %}
{% endblock %}

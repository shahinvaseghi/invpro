{% extends "shared/generic/generic_list.html" %}
{% load static i18n %}

{% block filter_fields %}
<div class="form-group">
  <label for="document_number">{{ filter_form.document_number.label }}</label>
  {{ filter_form.document_number }}
</div>
<div class="form-group">
  <label for="file_type">{{ filter_form.file_type.label }}</label>
  {{ filter_form.file_type }}
</div>
<div class="form-group">
  <label for="date_from">{{ filter_form.date_from.label }}</label>
  {{ filter_form.date_from }}
</div>
<div class="form-group">
  <label for="date_to">{{ filter_form.date_to.label }}</label>
  {{ filter_form.date_to }}
</div>
{% endblock %}

{% block extra_actions %}
<button type="button" class="btn btn-success" id="download-selected-btn" disabled>
  {% trans "Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡â€ŒÙ‡Ø§" %}
</button>
<span id="selected-count">0 {% trans "Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡" %}</span>
{% endblock %}

{% block table_headers %}
<th>
  <input type="checkbox" id="select-all" />
</th>
<th>{% trans "Ø´Ù…Ø§Ø±Ù‡ Ø³Ù†Ø¯" %}</th>
<th>{% trans "Ù†Ø§Ù… ÙØ§ÛŒÙ„" %}</th>
<th>{% trans "Ù†ÙˆØ¹ ÙØ§ÛŒÙ„" %}</th>
<th>{% trans "Ø­Ø¬Ù…" %}</th>
<th>{% trans "ØªØ§Ø±ÛŒØ® Ø¢Ù¾Ù„ÙˆØ¯" %}</th>
<th>{% trans "Ø¢Ù¾Ù„ÙˆØ¯Ú©Ù†Ù†Ø¯Ù‡" %}</th>
{% if show_actions %}
  <th>{% trans "Ø¹Ù…Ù„ÛŒØ§Øª" %}</th>
{% endif %}
{% endblock %}

{% block table_rows %}
{% if object_list %}
  {% for attachment in object_list %}
  <tr>
    <td>
      <input type="checkbox" class="attachment-checkbox" value="{{ attachment.id }}" />
    </td>
    <td>
      {% if attachment.document_number %}
        <code>{{ attachment.document_number }}</code>
      {% else %}
        <span class="text-muted">-</span>
      {% endif %}
    </td>
    <td>{{ attachment.file_name }}</td>
    <td>{{ attachment.get_file_type_display }}</td>
    <td>{{ attachment.get_file_size_display }}</td>
    <td>{{ attachment.uploaded_at|date:"Y/m/d H:i" }}</td>
    <td>{{ attachment.uploaded_by.username|default:"-" }}</td>
    {% if show_actions %}
      <td>
        <a href="{% url 'accounting:attachment_download_single' %}?id={{ attachment.id }}" 
           class="btn btn-sm btn-primary" 
           download>{% trans "Ø¯Ø§Ù†Ù„ÙˆØ¯" %}</a>
      </td>
    {% endif %}
  </tr>
  {% endfor %}
{% else %}
  <tr>
    <td colspan="{% if show_actions %}8{% else %}7{% endif %}" style="text-align: center; padding: 2rem;">
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“„</div>
        <h3>{% trans "Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯" %}</h3>
        <p>{% trans "Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÛŒÙ„ØªØ±Ù‡Ø§ ÛŒØ§ Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯." %}</p>
      </div>
    </td>
  </tr>
{% endif %}
{% endblock %}

{% block after_table %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const selectAll = document.getElementById('select-all');
  const checkboxes = document.querySelectorAll('.attachment-checkbox');
  const downloadBtn = document.getElementById('download-selected-btn');
  const selectedCount = document.getElementById('selected-count');

  function updateSelectedCount() {
    const selected = document.querySelectorAll('.attachment-checkbox:checked');
    const count = selected.length;
    selectedCount.textContent = count + ' {% trans "Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡" %}';
    downloadBtn.disabled = count === 0;
  }

  if (selectAll) {
    selectAll.addEventListener('change', function() {
      checkboxes.forEach(cb => cb.checked = this.checked);
      updateSelectedCount();
    });
  }

  checkboxes.forEach(cb => {
    cb.addEventListener('change', updateSelectedCount);
  });

  if (downloadBtn) {
    downloadBtn.addEventListener('click', function() {
      const selected = Array.from(document.querySelectorAll('.attachment-checkbox:checked'))
        .map(cb => cb.value);
      
      if (selected.length > 0) {
        const url = '{% url "accounting:attachment_download_bulk" %}?' + 
          selected.map(id => 'ids=' + id).join('&');
        window.location.href = url;
      }
    });
  }
});
</script>
{% endblock %}

{% load i18n access_tags %}
<!-- Modules Dropdown Menu -->
<div class="dropdown-menu" id="menu-modules">
  <!-- Shared Module -->
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-shared">
      <span class="menu-icon">ğŸ”§</span>
      <span>{% trans "Shared" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-shared">
      {% if user_feature_permissions|feature_allowed:'shared.companies' %}
        <a href="{% url 'shared:companies' %}" class="dropdown-item-sub">{% trans "Companies" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'shared.company_units' %}
        <a href="{% url 'shared:company_units' %}" class="dropdown-item-sub">{% trans "Company Units" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'shared.smtp_servers' or user.is_superuser %}
        <a href="{% url 'shared:smtp_servers' %}" class="dropdown-item-sub">{% trans "SMTP Servers" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'shared.users' or user_feature_permissions|feature_allowed:'shared.groups' or user_feature_permissions|feature_allowed:'shared.access_levels' %}
        <div class="dropdown-submenu">
          <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-shared-users">
            <span>{% trans "Users" %}</span>
            <span class="dropdown-arrow">â–¶</span>
          </button>
          <div class="dropdown-menu-sub" id="modules-shared-users">
            {% if user_feature_permissions|feature_allowed:'shared.users' %}
              <a href="{% url 'shared:users' %}" class="dropdown-item-sub">{% trans "Users" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'shared.groups' %}
              <a href="{% url 'shared:groups' %}" class="dropdown-item-sub">{% trans "Groups" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'shared.access_levels' %}
              <a href="{% url 'shared:access_levels' %}" class="dropdown-item-sub">{% trans "Access Levels" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Inventory Module -->
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-inventory">
      <span class="menu-icon">ğŸ“¦</span>
      <span>{% trans "Inventory" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-inventory">
      {% if user_feature_permissions|feature_allowed:'inventory.master.items' or user_feature_permissions|feature_allowed:'inventory.master.item_serials' or user_feature_permissions|feature_allowed:'inventory.balance' %}
        <div class="dropdown-submenu">
          <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-inventory-items">
            <span>{% trans "Items" %}</span>
            <span class="dropdown-arrow">â–¶</span>
          </button>
          <div class="dropdown-menu-sub" id="modules-inventory-items">
            {% if user_feature_permissions|feature_allowed:'inventory.master.items' %}
              <a href="{% url 'inventory:items' %}" class="dropdown-item-sub">{% trans "Edit Items" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.master.item_serials' %}
              <a href="{% url 'inventory:item_serials' %}" class="dropdown-item-sub">{% trans "Item Serials" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.balance' %}
              <a href="{% url 'inventory:inventory_balance' %}" class="dropdown-item-sub">{% trans "Inventory Balance" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'inventory.master.warehouses' %}
        <a href="{% url 'inventory:warehouses' %}" class="dropdown-item-sub">{% trans "Warehouses" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'inventory.suppliers.list' %}
        <a href="{% url 'inventory:suppliers' %}" class="dropdown-item-sub">{% trans "Suppliers" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'inventory.receipts.temporary' or user_feature_permissions|feature_allowed:'inventory.receipts.permanent' or user_feature_permissions|feature_allowed:'inventory.receipts.consignment' %}
        <div class="dropdown-submenu">
          <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-inventory-receipts">
            <span>{% trans "Receipts" %}</span>
            <span class="dropdown-arrow">â–¶</span>
          </button>
          <div class="dropdown-menu-sub" id="modules-inventory-receipts">
            {% if user_feature_permissions|feature_allowed:'inventory.receipts.temporary' %}
              <a href="{% url 'inventory:receipt_temporary' %}" class="dropdown-item-sub">{% trans "Temporary Receipts" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.receipts.permanent' %}
              <a href="{% url 'inventory:receipt_permanent' %}" class="dropdown-item-sub">{% trans "Permanent Receipts" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.receipts.consignment' %}
              <a href="{% url 'inventory:receipt_consignment' %}" class="dropdown-item-sub">{% trans "Consignment Receipts" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'inventory.issues.permanent' or user_feature_permissions|feature_allowed:'inventory.issues.consumption' or user_feature_permissions|feature_allowed:'inventory.issues.consignment' %}
        <div class="dropdown-submenu">
          <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-inventory-issues">
            <span>{% trans "Issues" %}</span>
            <span class="dropdown-arrow">â–¶</span>
          </button>
          <div class="dropdown-menu-sub" id="modules-inventory-issues">
            {% if user_feature_permissions|feature_allowed:'inventory.issues.permanent' %}
              <a href="{% url 'inventory:issue_permanent' %}" class="dropdown-item-sub">{% trans "Permanent Issues" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.issues.consumption' %}
              <a href="{% url 'inventory:issue_consumption' %}" class="dropdown-item-sub">{% trans "Consumption Issues" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.issues.consignment' %}
              <a href="{% url 'inventory:issue_consignment' %}" class="dropdown-item-sub">{% trans "Consignment Issues" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'inventory.requests.purchase' %}
        <a href="{% url 'inventory:purchase_requests' %}" class="dropdown-item-sub">{% trans "Purchase Requests" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'inventory.requests.warehouse' %}
        <a href="{% url 'inventory:warehouse_requests' %}" class="dropdown-item-sub">{% trans "Warehouse Requests" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'inventory.stocktaking.deficit' or user_feature_permissions|feature_allowed:'inventory.stocktaking.surplus' or user_feature_permissions|feature_allowed:'inventory.stocktaking.records' %}
        <div class="dropdown-submenu">
          <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-inventory-stocktaking">
            <span>{% trans "Stocktaking" %}</span>
            <span class="dropdown-arrow">â–¶</span>
          </button>
          <div class="dropdown-menu-sub" id="modules-inventory-stocktaking">
            {% if user_feature_permissions|feature_allowed:'inventory.stocktaking.deficit' %}
              <a href="{% url 'inventory:stocktaking_deficit' %}" class="dropdown-item-sub">{% trans "Deficit Records" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.stocktaking.surplus' %}
              <a href="{% url 'inventory:stocktaking_surplus' %}" class="dropdown-item-sub">{% trans "Surplus Records" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.stocktaking.records' %}
              <a href="{% url 'inventory:stocktaking_records' %}" class="dropdown-item-sub">{% trans "Stocktaking Records" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Production Module -->
  {% if user_feature_permissions|feature_allowed:'production.personnel' or user_feature_permissions|feature_allowed:'production.machines' or user_feature_permissions|feature_allowed:'production.work_lines' or user_feature_permissions|feature_allowed:'production.bom' or user_feature_permissions|feature_allowed:'production.processes' or user_feature_permissions|feature_allowed:'production.product_orders' or request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-production">
      <span class="menu-icon">âš™ï¸</span>
      <span>{% trans "Production" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-production">
      {% if user_feature_permissions|feature_allowed:'production.personnel' %}
        <a href="{% url 'production:personnel' %}" class="dropdown-item-sub">{% trans "Personnel" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'production.machines' %}
        <a href="{% url 'production:machines' %}" class="dropdown-item-sub">{% trans "Machines" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'production.work_lines' %}
        <a href="{% url 'production:work_lines' %}" class="dropdown-item-sub">{% trans "Work Lines" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'production.bom' or request.user.is_superuser %}
        <a href="{% url 'production:bom_list' %}" class="dropdown-item-sub">{% trans "BOM" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'production.processes' or request.user.is_superuser %}
        <a href="{% url 'production:processes' %}" class="dropdown-item-sub">{% trans "Processes" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'production.product_orders' or request.user.is_superuser %}
        <a href="{% url 'production:product_orders' %}" class="dropdown-item-sub">{% trans "Product Orders" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'production.transfer_requests' or request.user.is_superuser %}
        <a href="{% url 'production:transfer_requests' %}" class="dropdown-item-sub">{% trans "Transfer to Line Requests" %}</a>
      {% endif %}
      {% if request.user.is_superuser %}
        <a href="{% url 'production:performance_records' %}" class="dropdown-item-sub">{% trans "Performance" %}</a>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Quality Control Module -->
  {% if request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-qc">
      <span class="menu-icon">ğŸ”¬</span>
      <span>{% trans "Quality Control" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-qc">
      <a href="{% url 'qc:temporary_receipts' %}" class="dropdown-item-sub">{% trans "Inspections" %}</a>
    </div>
  </div>
  {% endif %}

  <!-- Ticketing Module -->
  {% if request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-ticketing">
      <span class="menu-icon">ğŸ«</span>
      <span>{% trans "Ticketing" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-ticketing">
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-ticketing-tickets">
          <span>{% trans "Tickets" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-ticketing-tickets">
          <a href="{% url 'ticketing:ticket_create' %}" class="dropdown-item-sub">{% trans "Create Ticket" %}</a>
          <a href="{% url 'ticketing:ticket_respond' %}" class="dropdown-item-sub">{% trans "Respond to Ticket" %}</a>
        </div>
      </div>
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-ticketing-templates">
          <span>{% trans "Templates" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-ticketing-templates">
          <a href="{% url 'ticketing:templates' %}" class="dropdown-item-sub">{% trans "Templates" %}</a>
          <a href="{% url 'ticketing:categories' %}" class="dropdown-item-sub">{% trans "Categories" %}</a>
          <a href="{% url 'ticketing:subcategories' %}" class="dropdown-item-sub">{% trans "Subcategories" %}</a>
        </div>
      </div>
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-ticketing-automation">
          <span>{% trans "Automation" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-ticketing-automation">
          <a href="{% url 'ticketing:auto_response' %}" class="dropdown-item-sub">{% trans "Auto Response" %}</a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Accounting Module -->
  {% if user_feature_permissions|feature_allowed:'accounting.dashboard' or request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting">
      <span class="menu-icon">ğŸ’°</span>
      <span>{% trans "Accounting" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-accounting">
      <!-- 1. ØªØ¹Ø§Ø±ÛŒÙ Ù¾Ø§ÛŒÙ‡ (Base Definitions) -->
      {% if user_feature_permissions|feature_allowed:'accounting.base.fiscal_years' or user_feature_permissions|feature_allowed:'accounting.base.accounts' or user_feature_permissions|feature_allowed:'accounting.base.gl' or user_feature_permissions|feature_allowed:'accounting.base.sub' or user_feature_permissions|feature_allowed:'accounting.base.tafsili' or user_feature_permissions|feature_allowed:'accounting.base.tafsili_hierarchy' or user_feature_permissions|feature_allowed:'accounting.base.cost_centers' or user_feature_permissions|feature_allowed:'accounting.base.income_expense_categories' or user_feature_permissions|feature_allowed:'accounting.base.parties' or user_feature_permissions|feature_allowed:'accounting.base.party_accounts' or user_feature_permissions|feature_allowed:'accounting.base.cash_accounts' or user_feature_permissions|feature_allowed:'accounting.base.checks' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-base">
          <span>{% trans "ØªØ¹Ø§Ø±ÛŒÙ Ù¾Ø§ÛŒÙ‡" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-base">
          {% if user_feature_permissions|feature_allowed:'accounting.base.fiscal_years' or request.user.is_superuser %}
            <a href="{% url 'accounting:fiscal_years' %}" class="dropdown-item-sub">{% trans "Ø³Ø§Ù„ Ù…Ø§Ù„ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.accounts' or request.user.is_superuser %}
            <a href="{% url 'accounting:accounts' %}" class="dropdown-item-sub">{% trans "Ú†Ø§Ø±Øª Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.gl' or request.user.is_superuser %}
            <a href="{% url 'accounting:gl_accounts' %}" class="dropdown-item-sub">{% trans "ØªØ¹Ø±ÛŒÙ Ø­Ø³Ø§Ø¨ Ú©Ù„" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.sub' or request.user.is_superuser %}
            <a href="{% url 'accounting:sub_accounts' %}" class="dropdown-item-sub">{% trans "ØªØ¹Ø±ÛŒÙ Ø­Ø³Ø§Ø¨ Ù…Ø¹ÛŒÙ†" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.tafsili' or request.user.is_superuser %}
            <a href="{% url 'accounting:tafsili_accounts' %}" class="dropdown-item-sub">{% trans "ØªØ¹Ø±ÛŒÙ Ø­Ø³Ø§Ø¨ ØªÙØµÛŒÙ„ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.tafsili_hierarchy' or request.user.is_superuser %}
            <a href="{% url 'accounting:tafsili_hierarchy_list' %}" class="dropdown-item-sub">{% trans "ØªÙØµÛŒÙ„ÛŒ Ú†Ù†Ø¯Ø³Ø·Ø­ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.cost_centers' or request.user.is_superuser %}
            <a href="{% url 'accounting:cost_centers' %}" class="dropdown-item-sub">{% trans "Ù…Ø±Ø§Ú©Ø² Ù‡Ø²ÛŒÙ†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.income_expense_categories' or request.user.is_superuser %}
            <a href="{% url 'accounting:income_expense_categories' %}" class="dropdown-item-sub">{% trans "Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.parties' or request.user.is_superuser %}
            <a href="{% url 'accounting:parties' %}" class="dropdown-item-sub">{% trans "Ø·Ø±Ù Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.cash_accounts' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_accounts' %}" class="dropdown-item-sub">{% trans "Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø¯ÛŒ Ùˆ Ø¨Ø§Ù†Ú©ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.base.checks' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_checks' %}" class="dropdown-item-sub">{% trans "Ù…Ø¯ÛŒØ±ÛŒØª Ú†Ú©â€ŒÙ‡Ø§" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- Accounting Documents -->
      {% if user_feature_permissions|feature_allowed:'accounting.documents.create' or user_feature_permissions|feature_allowed:'accounting.documents.list' or user_feature_permissions|feature_allowed:'accounting.documents.status' or user_feature_permissions|feature_allowed:'accounting.documents.movements' or user_feature_permissions|feature_allowed:'accounting.documents.tafsili_movements' or user_feature_permissions|feature_allowed:'accounting.documents.trial_balance' or user_feature_permissions|feature_allowed:'accounting.reports.balance_sheet' or user_feature_permissions|feature_allowed:'accounting.reports.income_statement' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-documents">
          <span>{% trans "Ø§Ø³Ù†Ø§Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-documents">
          {% if user_feature_permissions|feature_allowed:'accounting.documents.create' or request.user.is_superuser %}
            <a href="{% url 'accounting:document_create' %}" class="dropdown-item-sub">{% trans "Ø«Ø¨Øª Ø³Ù†Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.documents.list' or request.user.is_superuser %}
            <a href="{% url 'accounting:document_list' %}" class="dropdown-item-sub">{% trans "Ù„ÛŒØ³Øª Ø§Ø³Ù†Ø§Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.documents.status' or request.user.is_superuser %}
            <a href="{% url 'accounting:document_status' %}" class="dropdown-item-sub">{% trans "Ø³Ù†Ø¯Ù‡Ø§ÛŒ Ø¨Ø§Ø²ØŒ Ù‚Ø·Ø¹ÛŒØŒ Ø¨Ø±Ú¯Ø´ØªÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.documents.movements' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_account_movements' %}" class="dropdown-item-sub">{% trans "Ú¯Ø±Ø¯Ø´ Ø­Ø³Ø§Ø¨" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.documents.tafsili_movements' or request.user.is_superuser %}
            <a href="{% url 'accounting:tafsili_movements' %}" class="dropdown-item-sub">{% trans "Ú¯Ø±Ø¯Ø´ ØªÙØµÛŒÙ„ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.documents.trial_balance' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_trial_balance' %}" class="dropdown-item-sub">{% trans "ØªØ±Ø§Ø² Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.balance_sheet' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_balance_sheet' %}" class="dropdown-item-sub">{% trans "ØªØ±Ø§Ø²Ù†Ø§Ù…Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.income_statement' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_income_statement' %}" class="dropdown-item-sub">{% trans "ØµÙˆØ±Øª Ø³ÙˆØ¯ Ùˆ Ø²ÛŒØ§Ù†" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- 3. Ø®Ø²Ø§Ù†Ù‡â€ŒØ¯Ø§Ø±ÛŒ (Treasury) -->
      {% if user_feature_permissions|feature_allowed:'accounting.treasury.income' or user_feature_permissions|feature_allowed:'accounting.treasury.expense' or user_feature_permissions|feature_allowed:'accounting.treasury.receive' or user_feature_permissions|feature_allowed:'accounting.treasury.pay' or user_feature_permissions|feature_allowed:'accounting.treasury.transactions' or user_feature_permissions|feature_allowed:'accounting.treasury.transfer' or user_feature_permissions|feature_allowed:'accounting.treasury.checks' or user_feature_permissions|feature_allowed:'accounting.treasury.reconciliation' or user_feature_permissions|feature_allowed:'accounting.treasury.cash_report' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-treasury">
          <span>{% trans "Ø®Ø²Ø§Ù†Ù‡â€ŒØ¯Ø§Ø±ÛŒ" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-treasury">
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.income' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_income' %}" class="dropdown-item-sub">{% trans "Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.expense' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_expense' %}" class="dropdown-item-sub">{% trans "Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.receive' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_receive' %}" class="dropdown-item-sub">{% trans "Ø¯Ø±ÛŒØ§ÙØª" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.pay' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_pay' %}" class="dropdown-item-sub">{% trans "Ù¾Ø±Ø¯Ø§Ø®Øª" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.transactions' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_transactions' %}" class="dropdown-item-sub">{% trans "ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø®Ø²Ø§Ù†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.transfer' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_transfer' %}" class="dropdown-item-sub">{% trans "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÛŒÙ† Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.checks' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_checks' %}" class="dropdown-item-sub">{% trans "Ù…Ø¯ÛŒØ±ÛŒØª Ú†Ú©â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.reconciliation' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_reconciliation' %}" class="dropdown-item-sub">{% trans "ØªØ·Ø¨ÛŒÙ‚ Ø¨Ø§Ù†Ú©ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.treasury.cash_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:treasury_cash_report' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¬ÙˆÙ‡ Ù†Ù‚Ø¯ Ùˆ Ø¨Ø§Ù†Ú©â€ŒÙ‡Ø§" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- 4. Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡ (Income & Expense) -->
      {% if user_feature_permissions|feature_allowed:'accounting.income_expense.income' or user_feature_permissions|feature_allowed:'accounting.income_expense.expense' or user_feature_permissions|feature_allowed:'accounting.income_expense.cost_allocation' or user_feature_permissions|feature_allowed:'accounting.income_expense.income_report' or user_feature_permissions|feature_allowed:'accounting.income_expense.expense_report' or user_feature_permissions|feature_allowed:'accounting.income_expense.cost_center_report' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-income-expense">
          <span>{% trans "Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-income-expense">
          {% if user_feature_permissions|feature_allowed:'accounting.income_expense.income' or request.user.is_superuser %}
            <a href="{% url 'accounting:income_expense_income' %}" class="dropdown-item-sub">{% trans "Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.income_expense.expense' or request.user.is_superuser %}
            <a href="{% url 'accounting:income_expense_expense' %}" class="dropdown-item-sub">{% trans "Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.income_expense.cost_allocation' or request.user.is_superuser %}
            <a href="{% url 'accounting:cost_allocation' %}" class="dropdown-item-sub">{% trans "ØªØ®ØµÛŒØµ Ù…Ø±Ú©Ø² Ù‡Ø²ÛŒÙ†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.income_expense.income_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:income_report' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø±Ø¢Ù…Ø¯" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.income_expense.expense_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:expense_report' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ù‡Ø²ÛŒÙ†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.income_expense.cost_center_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:cost_center_report' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ù…Ø±Ø§Ú©Ø² Ù‡Ø²ÛŒÙ†Ù‡" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- 5. Ø·Ø±Ù Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ (Party Management) -->
      {% if user_feature_permissions|feature_allowed:'accounting.parties.list' or user_feature_permissions|feature_allowed:'accounting.parties.accounts' or user_feature_permissions|feature_allowed:'accounting.parties.movements' or user_feature_permissions|feature_allowed:'accounting.parties.balance_report' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-parties">
          <span>{% trans "Ø·Ø±Ù Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-parties">
          {% if user_feature_permissions|feature_allowed:'accounting.parties.list' or request.user.is_superuser %}
            <a href="{% url 'accounting:parties' %}" class="dropdown-item-sub">{% trans "Ù„ÛŒØ³Øª Ø·Ø±Ù Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.parties.movements' or request.user.is_superuser %}
            <a href="{% url 'accounting:party_movements' %}" class="dropdown-item-sub">{% trans "Ú¯Ø±Ø¯Ø´ Ø·Ø±Ù Ø­Ø³Ø§Ø¨" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.parties.balance_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:party_balance_report' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù†Ø¯Ù‡ Ø·Ø±Ù Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- 6. Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯ (Payroll Accounting) -->
      {% if user_feature_permissions|feature_allowed:'accounting.payroll.payment' or user_feature_permissions|feature_allowed:'accounting.payroll.insurance_tax' or user_feature_permissions|feature_allowed:'accounting.payroll.document' or user_feature_permissions|feature_allowed:'accounting.payroll.bank_transfer' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-payroll">
          <span>{% trans "Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-payroll">
          {% if user_feature_permissions|feature_allowed:'accounting.payroll.payment' or request.user.is_superuser %}
            <a href="{% url 'accounting:payroll_payment' %}" class="dropdown-item-sub">{% trans "Ù¾Ø±Ø¯Ø§Ø®Øª Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.payroll.insurance_tax' or request.user.is_superuser %}
            <a href="{% url 'accounting:payroll_insurance_tax' %}" class="dropdown-item-sub">{% trans "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨ÛŒÙ…Ù‡ Ùˆ Ù…Ø§Ù„ÛŒØ§Øª" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.payroll.document' or request.user.is_superuser %}
            <a href="{% url 'accounting:payroll_document' %}" class="dropdown-item-sub">{% trans "Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø³Ù†Ø§Ø¯ Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.payroll.bank_transfer' or request.user.is_superuser %}
            <a href="{% url 'accounting:payroll_bank_transfer' %}" class="dropdown-item-sub">{% trans "Ø®Ø±ÙˆØ¬ÛŒ Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ù†Ú©" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- Tax Compliance -->
      {% if user_feature_permissions|feature_allowed:'accounting.tax.vat' or user_feature_permissions|feature_allowed:'accounting.tax.vat_report' or user_feature_permissions|feature_allowed:'accounting.tax.seasonal' or user_feature_permissions|feature_allowed:'accounting.tax.validation' or user_feature_permissions|feature_allowed:'accounting.tax.discrepancy_report' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-tax">
          <span>{% trans "Ù…Ø§Ù„ÛŒØ§Øª Ùˆ Ù…Ù‚Ø±Ø±Ø§Øª" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-tax">
          {% if user_feature_permissions|feature_allowed:'accounting.tax.vat' or request.user.is_superuser %}
            <a href="{% url 'accounting:tax_vat' %}" class="dropdown-item-sub">{% trans "Ù…Ø¯ÛŒØ±ÛŒØª VAT" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.tax.vat_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_vat' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ VAT" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.tax.seasonal' or request.user.is_superuser %}
            <a href="{% url 'accounting:tax_seasonal' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ ÙØµÙ„ÛŒ (TTMS / Ù…Ø§Ø¯Ù‡ 169)" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.tax.validation' or request.user.is_superuser %}
            <a href="{% url 'accounting:tax_validation' %}" class="dropdown-item-sub">{% trans "Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø³Ù†Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…ÙˆØ¯ÛŒØ§Ù†" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.tax.discrepancy_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:tax_discrepancy_report' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ù…ØºØ§ÛŒØ±Øª Ù…Ø§Ù„ÛŒØ§ØªÛŒ" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- 8. Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù…Ø§Ù„ÛŒ (Financial Reports) -->
      {% if user_feature_permissions|feature_allowed:'accounting.reports.trial_balance' or user_feature_permissions|feature_allowed:'accounting.reports.balance_sheet' or user_feature_permissions|feature_allowed:'accounting.reports.income_statement' or user_feature_permissions|feature_allowed:'accounting.reports.cash_flow' or user_feature_permissions|feature_allowed:'accounting.reports.account_report' or user_feature_permissions|feature_allowed:'accounting.reports.tafsili_cost_center' or user_feature_permissions|feature_allowed:'accounting.reports.check_report' or user_feature_permissions|feature_allowed:'accounting.reports.treasury_report' or user_feature_permissions|feature_allowed:'accounting.reports.party_report' or user_feature_permissions|feature_allowed:'accounting.reports.vat' or user_feature_permissions|feature_allowed:'accounting.reports.monthly' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-reports">
          <span>{% trans "Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù…Ø§Ù„ÛŒ" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-reports">
          {% if user_feature_permissions|feature_allowed:'accounting.reports.trial_balance' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_trial_balance' %}" class="dropdown-item-sub">{% trans "ØªØ±Ø§Ø² Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.balance_sheet' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_balance_sheet' %}" class="dropdown-item-sub">{% trans "ØªØ±Ø§Ø²Ù†Ø§Ù…Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.income_statement' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_income_statement' %}" class="dropdown-item-sub">{% trans "Ø³ÙˆØ¯ Ùˆ Ø²ÛŒØ§Ù†" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.cash_flow' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_cash_flow' %}" class="dropdown-item-sub">{% trans "Ø¬Ø±ÛŒØ§Ù† ÙˆØ¬ÙˆÙ‡ Ù†Ù‚Ø¯" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.account_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_account_movements' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.tafsili_cost_center' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_tafsili_cost_center' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ ØªÙØµÛŒÙ„ÛŒ Ùˆ Ù…Ø±Ø§Ú©Ø² Ù‡Ø²ÛŒÙ†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.check_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_checks' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ú†Ú©â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.treasury_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_treasury' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ø®Ø²Ø§Ù†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.party_report' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_party_statement' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ø·Ø±Ù Ø­Ø³Ø§Ø¨" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.vat' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_vat' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ VAT" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.reports.monthly' or request.user.is_superuser %}
            <a href="{% url 'accounting:report_monthly' %}" class="dropdown-item-sub">{% trans "Ú¯Ø²Ø§Ø±Ø´ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§Ù‡Ø§Ù†Ù‡" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- 9. Ø§Ø³Ù†Ø§Ø¯ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ (Attachments) -->
      {% if user_feature_permissions|feature_allowed:'accounting.attachments.upload' or user_feature_permissions|feature_allowed:'accounting.attachments.manage' or user_feature_permissions|feature_allowed:'accounting.attachments.attach_to_document' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-attachments">
          <span>{% trans "Ø§Ø³Ù†Ø§Ø¯ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-attachments">
          {% if user_feature_permissions|feature_allowed:'accounting.attachments.upload' or request.user.is_superuser %}
            <a href="{% url 'accounting:attachment_upload' %}" class="dropdown-item-sub">{% trans "Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø³Ù†Ø§Ø¯" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.attachments.manage' or request.user.is_superuser %}
            <a href="{% url 'accounting:attachment_list' %}" class="dropdown-item-sub">{% trans "Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ù†Ø§Ø¯ Ù¾ÛŒÙˆØ³Øª" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.attachments.attach_to_document' or request.user.is_superuser %}
            <a href="{% url 'accounting:attachment_attach' %}" class="dropdown-item-sub">{% trans "Ù¾ÛŒÙˆØ³Øª Ø¨Ù‡ Ø³Ù†Ø¯" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- 10. Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ Ùˆ Ø¹Ù…Ù„ÛŒØ§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ (Utilities) -->
      {% if user_feature_permissions|feature_allowed:'accounting.utils.close_temp' or user_feature_permissions|feature_allowed:'accounting.utils.opening' or user_feature_permissions|feature_allowed:'accounting.utils.closing' or user_feature_permissions|feature_allowed:'accounting.utils.integration' or user_feature_permissions|feature_allowed:'accounting.utils.backup' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-utils">
          <span>{% trans "Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ Ùˆ Ø¹Ù…Ù„ÛŒØ§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-utils">
          {% if user_feature_permissions|feature_allowed:'accounting.utils.close_temp' or request.user.is_superuser %}
            <a href="{% url 'accounting:close_temp_accounts' %}" class="dropdown-item-sub">{% trans "Ø¨Ø³ØªÙ† Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙ‚Øª" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.utils.opening' or request.user.is_superuser %}
            <a href="{% url 'accounting:opening_entry' %}" class="dropdown-item-sub">{% trans "Ø§ÙØªØªØ§Ø­ÛŒÙ‡ Ø®ÙˆØ¯Ú©Ø§Ø±" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.utils.closing' or request.user.is_superuser %}
            <a href="{% url 'accounting:closing_entry' %}" class="dropdown-item-sub">{% trans "Ø§Ø®ØªØªØ§Ù…ÛŒÙ‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.utils.integration' or request.user.is_superuser %}
            <a href="{% url 'accounting:integration' %}" class="dropdown-item-sub">{% trans "ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.utils.backup' or request.user.is_superuser %}
            <a href="{% url 'accounting:backup_restore' %}" class="dropdown-item-sub">{% trans "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- Settings -->
      {% if user_feature_permissions|feature_allowed:'accounting.settings' or user_feature_permissions|feature_allowed:'accounting.settings.treasury' or user_feature_permissions|feature_allowed:'accounting.settings.tax' or request.user.is_superuser %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-accounting-settings">
          <span>{% trans "ØªÙ†Ø¸ÛŒÙ…Ø§Øª" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-accounting-settings">
          {% if user_feature_permissions|feature_allowed:'accounting.settings' or request.user.is_superuser %}
            <a href="{% url 'accounting:settings' %}" class="dropdown-item-sub">{% trans "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.settings.treasury' or request.user.is_superuser %}
            <a href="{% url 'accounting:settings_treasury' %}" class="dropdown-item-sub">{% trans "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®Ø²Ø§Ù†Ù‡" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'accounting.settings.tax' or request.user.is_superuser %}
            <a href="{% url 'accounting:settings_tax' %}" class="dropdown-item-sub">{% trans "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù„ÛŒØ§Øª" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Sales Module -->
  {% if user_feature_permissions|feature_allowed:'sales.dashboard' or request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-sales">
      <span class="menu-icon">ğŸ›’</span>
      <span>{% trans "Sales" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-sales">
      <a href="{% url 'sales:dashboard' %}" class="dropdown-item-sub">{% trans "Dashboard" %}</a>
      {% if user_feature_permissions|feature_allowed:'sales.invoice' %}
      <a href="{% url 'sales:invoice_create' %}" class="dropdown-item-sub">{% trans "Sales Invoice" %}</a>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Human Resources Module -->
  {% if user_feature_permissions|feature_allowed:'hr.dashboard' or request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-hr">
      <span class="menu-icon">ğŸ‘¥</span>
      <span>{% trans "Human Resources" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-hr">
      <a href="{% url 'hr:dashboard' %}" class="dropdown-item-sub">{% trans "Dashboard" %}</a>
      {% if user_feature_permissions|feature_allowed:'hr.personnel' or user_feature_permissions|feature_allowed:'hr.personnel.decree' or user_feature_permissions|feature_allowed:'hr.personnel.form' or user_feature_permissions|feature_allowed:'hr.personnel.form_groups' or user_feature_permissions|feature_allowed:'hr.personnel.form_subgroups' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-hr-personnel">
          <span>{% trans "Personnel" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-hr-personnel">
          {% if user_feature_permissions|feature_allowed:'hr.personnel' %}
          <a href="{% url 'hr:personnel_create' %}" class="dropdown-item-sub">{% trans "Create Personnel" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.personnel.decree' %}
          <a href="{% url 'hr:personnel_decree_assignment' %}" class="dropdown-item-sub">{% trans "Assign Decree" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.personnel.form' %}
          <a href="{% url 'hr:personnel_form_create' %}" class="dropdown-item-sub">{% trans "Personnel Form" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.personnel.form_groups' %}
          <a href="{% url 'hr:personnel_form_groups' %}" class="dropdown-item-sub">{% trans "Form Groups" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.personnel.form_subgroups' %}
          <a href="{% url 'hr:personnel_form_subgroups' %}" class="dropdown-item-sub">{% trans "Form Subgroups" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'hr.payroll.decrees' or user_feature_permissions|feature_allowed:'hr.payroll.decree_groups' or user_feature_permissions|feature_allowed:'hr.payroll.decree_subgroups' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-hr-payroll-decrees">
          <span>{% trans "Ø­Ú©Ù…â€ŒÙ‡Ø§ÛŒ Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-hr-payroll-decrees">
          {% if user_feature_permissions|feature_allowed:'hr.payroll.decrees' %}
          <a href="{% url 'hr:payroll_decrees' %}" class="dropdown-item-sub">{% trans "Ø­Ú©Ù…â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.payroll.decree_groups' %}
          <a href="{% url 'hr:payroll_decree_groups' %}" class="dropdown-item-sub">{% trans "Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ú©Ù…â€ŒÙ‡Ø§" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.payroll.decree_subgroups' %}
          <a href="{% url 'hr:payroll_decree_subgroups' %}" class="dropdown-item-sub">{% trans "Ø²ÛŒØ± Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ú©Ù…â€ŒÙ‡Ø§" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'hr.requests.leave' or user_feature_permissions|feature_allowed:'hr.requests.sick_leave' or user_feature_permissions|feature_allowed:'hr.requests.loan' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-hr-requests">
          <span>{% trans "Requests" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-hr-requests">
          {% if user_feature_permissions|feature_allowed:'hr.requests.leave' %}
          <a href="{% url 'hr:requests_leave' %}" class="dropdown-item-sub">{% trans "Leave Request" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.requests.sick_leave' %}
          <a href="{% url 'hr:requests_sick_leave' %}" class="dropdown-item-sub">{% trans "Sick Leave Request" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.requests.loan' %}
          <a href="{% url 'hr:requests_loan' %}" class="dropdown-item-sub">{% trans "Loan Request" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'hr.loans.management' or user_feature_permissions|feature_allowed:'hr.loans.scheduling' or user_feature_permissions|feature_allowed:'hr.loans.savings_fund' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-hr-loans">
          <span>{% trans "Loans" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-hr-loans">
          {% if user_feature_permissions|feature_allowed:'hr.loans.management' %}
          <a href="{% url 'hr:loans_management' %}" class="dropdown-item-sub">{% trans "Loan Management" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.loans.scheduling' %}
          <a href="{% url 'hr:loans_scheduling' %}" class="dropdown-item-sub">{% trans "Scheduling" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'hr.loans.savings_fund' %}
          <a href="{% url 'hr:loans_savings_fund' %}" class="dropdown-item-sub">{% trans "Savings Fund" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Office Automation Module -->
  {% if user_feature_permissions|feature_allowed:'office_automation.dashboard' or request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-office-automation">
      <span class="menu-icon">ğŸ“‹</span>
      <span>{% trans "Office Automation" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-office-automation">
      <a href="{% url 'office_automation:dashboard' %}" class="dropdown-item-sub">{% trans "Dashboard" %}</a>
      {% if user_feature_permissions|feature_allowed:'office_automation.inbox.incoming' or user_feature_permissions|feature_allowed:'office_automation.inbox.write' or user_feature_permissions|feature_allowed:'office_automation.inbox.fill_form' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-office-automation-inbox">
          <span>{% trans "Inbox" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-office-automation-inbox">
          {% if user_feature_permissions|feature_allowed:'office_automation.inbox.incoming' %}
          <a href="{% url 'office_automation:inbox_incoming' %}" class="dropdown-item-sub">{% trans "Incoming Letters" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'office_automation.inbox.write' %}
          <a href="{% url 'office_automation:inbox_write' %}" class="dropdown-item-sub">{% trans "Write Letter" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'office_automation.inbox.fill_form' %}
          <a href="{% url 'office_automation:inbox_fill_form' %}" class="dropdown-item-sub">{% trans "Fill Form" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'office_automation.processes.engine' or user_feature_permissions|feature_allowed:'office_automation.processes.form_connection' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-office-automation-processes">
          <span>{% trans "Processes" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-office-automation-processes">
          {% if user_feature_permissions|feature_allowed:'office_automation.processes.engine' %}
          <a href="{% url 'office_automation:processes_engine' %}" class="dropdown-item-sub">{% trans "Process Engine" %}</a>
          {% endif %}
          {% if user_feature_permissions|feature_allowed:'office_automation.processes.form_connection' %}
          <a href="{% url 'office_automation:processes_form_connection' %}" class="dropdown-item-sub">{% trans "Process-Form Connection" %}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'office_automation.forms.builder' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-office-automation-forms">
          <span>{% trans "Forms" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-office-automation-forms">
          <a href="{% url 'office_automation:forms_builder' %}" class="dropdown-item-sub">{% trans "Form Builder" %}</a>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Transportation Module -->
  {% if user_feature_permissions|feature_allowed:'transportation.dashboard' or request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-transportation">
      <span class="menu-icon">ğŸšš</span>
      <span>{% trans "Transportation" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-transportation">
      <a href="{% url 'transportation:dashboard' %}" class="dropdown-item-sub">{% trans "Dashboard" %}</a>
    </div>
  </div>
  {% endif %}

  <!-- Procurement Module -->
  {% if user_feature_permissions|feature_allowed:'procurement.dashboard' or request.user.is_superuser %}
  <div class="dropdown-submenu">
    <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-procurement">
      <span class="menu-icon">ğŸ›ï¸</span>
      <span>{% trans "Procurement" %}</span>
      <span class="dropdown-arrow">â–¶</span>
    </button>
    <div class="dropdown-menu-sub" id="modules-procurement">
      <a href="{% url 'procurement:dashboard' %}" class="dropdown-item-sub">{% trans "Dashboard" %}</a>
      {% if user_feature_permissions|feature_allowed:'procurement.purchases' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-procurement-purchases">
          <span>{% trans "Purchases" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-procurement-purchases">
          <a href="{% url 'procurement:purchases' %}" class="dropdown-item-sub">{% trans "Purchases" %}</a>
        </div>
      </div>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'procurement.buyers' %}
      <div class="dropdown-submenu">
        <button type="button" class="dropdown-item dropdown-toggle" data-submenu="modules-procurement-buyers">
          <span>{% trans "Buyers" %}</span>
          <span class="dropdown-arrow">â–¶</span>
        </button>
        <div class="dropdown-menu-sub" id="modules-procurement-buyers">
          <a href="{% url 'procurement:buyer_create' %}" class="dropdown-item-sub">{% trans "Define Buyers" %}</a>
          <a href="{% url 'procurement:buyer_assignment' %}" class="dropdown-item-sub">{% trans "Assign Buyers" %}</a>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>


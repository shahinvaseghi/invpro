{% load i18n access_tags %}
<nav class="sidebar-nav">
  <div class="sidebar-section" data-section="shared">
    <button type="button" class="section-header" data-target="shared">
      <span class="section-title">{% trans "Shared" %}</span>
      <span class="section-icon">▼</span>
    </button>
    <div class="section-content" id="shared">
      <a href="{% url 'ui:dashboard' %}" class="nav-link">{% trans "Dashboard" %}</a>
      {% if user_feature_permissions|feature_allowed:'shared.companies' %}
        <a href="{% url 'shared:companies' %}" class="nav-link">{% trans "Companies" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'shared.company_units' %}
        <a href="{% url 'shared:company_units' %}" class="nav-link">{% trans "Company Units" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'shared.smtp_servers' or user.is_superuser %}
        <a href="{% url 'shared:smtp_servers' %}" class="nav-link">{% trans "SMTP Servers" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'shared.users' or user_feature_permissions|feature_allowed:'shared.groups' or user_feature_permissions|feature_allowed:'shared.access_levels' %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="shared-users">
            <span>{% trans "Users" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="shared-users">
            {% if user_feature_permissions|feature_allowed:'shared.users' %}
              <a href="{% url 'shared:users' %}" class="nav-link-sub">{% trans "Users" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'shared.groups' %}
              <a href="{% url 'shared:groups' %}" class="nav-link-sub">{% trans "Groups" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'shared.access_levels' %}
              <a href="{% url 'shared:access_levels' %}" class="nav-link-sub">{% trans "Access Levels" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <div class="sidebar-section" data-section="inventory">
    <button type="button" class="section-header" data-target="inventory">
      <span class="section-title">{% trans "Inventory" %}</span>
      <span class="section-icon">▼</span>
    </button>
    <div class="section-content" id="inventory">
      {% if user_feature_permissions|feature_allowed:'inventory.master.warehouses' %}
        <a href="{% url 'inventory:warehouses' %}" class="nav-link">{% trans "Warehouses" %}</a>
      {% endif %}

      {% if user_feature_permissions|feature_allowed:'inventory.master.items' or user_feature_permissions|feature_allowed:'inventory.balance' %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="inventory-items">
            <span>{% trans "Items" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="inventory-items">
            {% if user_feature_permissions|feature_allowed:'inventory.master.items' %}
              <a href="{% url 'inventory:items' %}" class="nav-link-sub">{% trans "Edit Items" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.master.item_serials' %}
              <a href="{% url 'inventory:item_serials' %}" class="nav-link-sub">{% trans "Item Serials" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.balance' %}
              <a href="{% url 'inventory:inventory_balance' %}" class="nav-link-sub">{% trans "Inventory Balance" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      {% if user_feature_permissions|feature_allowed:'inventory.suppliers.categories' or user_feature_permissions|feature_allowed:'inventory.suppliers.list' %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="inventory-suppliers">
            <span>{% trans "Suppliers" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="inventory-suppliers">
            {% if user_feature_permissions|feature_allowed:'inventory.suppliers.categories' %}
              <a href="{% url 'inventory:supplier_categories' %}" class="nav-link-sub">{% trans "Supplier Categories" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.suppliers.list' %}
              <a href="{% url 'inventory:suppliers' %}" class="nav-link-sub">{% trans "Supplier List" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      {% if user_feature_permissions|feature_allowed:'inventory.requests.purchase' %}
        <a href="{% url 'inventory:purchase_requests' %}" class="nav-link">{% trans "Purchase Requests" %}</a>
      {% endif %}
      {% if user_feature_permissions|feature_allowed:'inventory.requests.warehouse' %}
        <a href="{% url 'inventory:warehouse_requests' %}" class="nav-link">{% trans "Warehouse Requests" %}</a>
      {% endif %}

      {% if user_feature_permissions|feature_allowed:'inventory.receipts.temporary' or user_feature_permissions|feature_allowed:'inventory.receipts.permanent' or user_feature_permissions|feature_allowed:'inventory.receipts.consignment' %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="inventory-receipts">
            <span>{% trans "Receipts" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="inventory-receipts">
            {% if user_feature_permissions|feature_allowed:'inventory.receipts.temporary' %}
              <a href="{% url 'inventory:receipt_temporary' %}" class="nav-link-sub">{% trans "Temporary Receipts" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.receipts.permanent' %}
              <a href="{% url 'inventory:receipt_permanent' %}" class="nav-link-sub">{% trans "Permanent Receipts" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.receipts.consignment' %}
              <a href="{% url 'inventory:receipt_consignment' %}" class="nav-link-sub">{% trans "Consignment Receipts" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      {% if user_feature_permissions|feature_allowed:'inventory.issues.permanent' or user_feature_permissions|feature_allowed:'inventory.issues.consumption' or user_feature_permissions|feature_allowed:'inventory.issues.consignment' %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="inventory-issues">
            <span>{% trans "Issues" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="inventory-issues">
            {% if user_feature_permissions|feature_allowed:'inventory.issues.permanent' %}
              <a href="{% url 'inventory:issue_permanent' %}" class="nav-link-sub">{% trans "Permanent Issues" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.issues.consumption' %}
              <a href="{% url 'inventory:issue_consumption' %}" class="nav-link-sub">{% trans "Consumption Issues" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.issues.consignment' %}
              <a href="{% url 'inventory:issue_consignment' %}" class="nav-link-sub">{% trans "Consignment Issues" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      {% if user_feature_permissions|feature_allowed:'inventory.stocktaking.deficit' or user_feature_permissions|feature_allowed:'inventory.stocktaking.surplus' or user_feature_permissions|feature_allowed:'inventory.stocktaking.records' %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="inventory-stocktaking">
            <span>{% trans "Stocktaking" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="inventory-stocktaking">
            {% if user_feature_permissions|feature_allowed:'inventory.stocktaking.deficit' %}
              <a href="{% url 'inventory:stocktaking_deficit' %}" class="nav-link-sub">{% trans "Deficit Records" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.stocktaking.surplus' %}
              <a href="{% url 'inventory:stocktaking_surplus' %}" class="nav-link-sub">{% trans "Surplus Records" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'inventory.stocktaking.records' %}
              <a href="{% url 'inventory:stocktaking_records' %}" class="nav-link-sub">{% trans "Stocktaking Records" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  {% if user_feature_permissions|feature_allowed:'production.personnel' or user_feature_permissions|feature_allowed:'production.machines' or user_feature_permissions|feature_allowed:'production.work_lines' or user_feature_permissions|feature_allowed:'production.bom' or user_feature_permissions|feature_allowed:'production.processes' or user_feature_permissions|feature_allowed:'production.product_orders' or request.user.is_superuser %}
    <div class="sidebar-section" data-section="production">
      <button type="button" class="section-header" data-target="production">
        <span class="section-title">{% trans "Production" %}</span>
        <span class="section-icon">▼</span>
      </button>
      <div class="section-content" id="production">
        {% if user_feature_permissions|feature_allowed:'production.personnel' %}
          <a href="{% url 'production:personnel' %}" class="nav-link">{% trans "Personnel" %}</a>
        {% endif %}
        {% if user_feature_permissions|feature_allowed:'production.machines' %}
          <a href="{% url 'production:machines' %}" class="nav-link">{% trans "Machines" %}</a>
        {% endif %}
        {% if user_feature_permissions|feature_allowed:'production.work_lines' %}
          <a href="{% url 'production:work_lines' %}" class="nav-link">{% trans "Work Lines" %}</a>
        {% endif %}
        {% if user_feature_permissions|feature_allowed:'production.bom' or request.user.is_superuser %}
          <a href="{% url 'production:bom_list' %}" class="nav-link">{% trans "BOM" %}</a>
        {% endif %}
        {% if user_feature_permissions|feature_allowed:'production.processes' or request.user.is_superuser %}
          <a href="{% url 'production:processes' %}" class="nav-link">{% trans "Processes" %}</a>
        {% endif %}
        {% if user_feature_permissions|feature_allowed:'production.product_orders' or request.user.is_superuser %}
          <a href="{% url 'production:product_orders' %}" class="nav-link">{% trans "Product Orders" %}</a>
        {% endif %}
        {% if user_feature_permissions|feature_allowed:'production.transfer_requests' or request.user.is_superuser %}
          <a href="{% url 'production:transfer_requests' %}" class="nav-link">{% trans "Transfer to Line Requests" %}</a>
        {% endif %}
        {% if request.user.is_superuser %}
          <a href="{% url 'production:performance_records' %}" class="nav-link">{% trans "Performance Records" %}</a>
        {% endif %}
      </div>
    </div>
  {% endif %}

  {% if request.user.is_superuser %}
    <div class="sidebar-section" data-section="qc">
      <button type="button" class="section-header" data-target="qc">
        <span class="section-title">{% trans "Quality Control" %}</span>
        <span class="section-icon">▼</span>
      </button>
      <div class="section-content" id="qc">
        <a href="{% url 'qc:temporary_receipts' %}" class="nav-link">{% trans "Temporary Receipts" %}</a>
      </div>
    </div>
  {% endif %}

  {% if request.user.is_superuser %}
    <div class="sidebar-section" data-section="ticketing">
      <button type="button" class="section-header" data-target="ticketing">
        <span class="section-title">{% trans "Ticketing" %}</span>
        <span class="section-icon">▼</span>
      </button>
      <div class="section-content" id="ticketing">
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="ticketing-tickets">
            <span>{% trans "Tickets" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="ticketing-tickets">
            <a href="{% url 'ticketing:ticket_create' %}" class="nav-link-sub">{% trans "Create Ticket" %}</a>
            <a href="{% url 'ticketing:ticket_respond' %}" class="nav-link-sub">{% trans "Respond to Ticket" %}</a>
          </div>
        </div>

        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="ticketing-templates">
            <span>{% trans "Templates" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="ticketing-templates">
            <a href="{% url 'ticketing:templates' %}" class="nav-link-sub">{% trans "Templates" %}</a>
            <a href="{% url 'ticketing:categories' %}" class="nav-link-sub">{% trans "Categories" %}</a>
            <a href="{% url 'ticketing:subcategories' %}" class="nav-link-sub">{% trans "Subcategories" %}</a>
          </div>
        </div>

        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="ticketing-automation">
            <span>{% trans "Automation" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="ticketing-automation">
            <a href="{% url 'ticketing:auto_response' %}" class="nav-link-sub">{% trans "Auto Response" %}</a>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Accounting Section -->
  <div class="sidebar-section" data-section="accounting">
    <button type="button" class="section-header" data-target="accounting">
      <span class="section-title">{% trans "Accounting" %}</span>
      <span class="section-icon">▼</span>
    </button>
    <div class="section-content" id="accounting">
      <!-- Fiscal Years -->
      {% if user_feature_permissions|feature_allowed:'accounting.fiscal_years' or request.user.is_superuser %}
        <a href="{% url 'accounting:fiscal_years' %}" class="nav-link">{% trans "سال مالی" %}</a>
      {% endif %}

      <!-- Chart of Accounts -->
      {% if user_feature_permissions|feature_allowed:'accounting.accounts' or request.user.is_superuser %}
        <a href="{% url 'accounting:accounts' %}" class="nav-link">{% trans "چارت حساب‌ها" %}</a>
      {% endif %}

      <!-- General Section -->
      {% if user_feature_permissions|feature_allowed:'accounting.general.ledger' or user_feature_permissions|feature_allowed:'accounting.general.subsidiary' or user_feature_permissions|feature_allowed:'accounting.general.detail' or request.user.is_superuser %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="accounting-general">
            <span>{% trans "عمومی" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="accounting-general">
            {% if user_feature_permissions|feature_allowed:'accounting.general.ledger' or request.user.is_superuser %}
              <a href="{% url 'accounting:general_ledger' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "اسناد کل" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.general.subsidiary' or request.user.is_superuser %}
              <a href="{% url 'accounting:general_subsidiary' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "معین‌ها" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.general.detail' or request.user.is_superuser %}
              <a href="{% url 'accounting:general_detail' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "تفصیلی‌ها" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Accounting Documents -->
      {% if user_feature_permissions|feature_allowed:'accounting.documents.entry' or user_feature_permissions|feature_allowed:'accounting.documents.exit' or request.user.is_superuser %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="accounting-documents">
            <span>{% trans "اسناد حسابداری" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="accounting-documents">
            {% if user_feature_permissions|feature_allowed:'accounting.documents.entry' or request.user.is_superuser %}
              <a href="{% url 'accounting:document_entry' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "سند ورودی" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.documents.exit' or request.user.is_superuser %}
              <a href="{% url 'accounting:document_exit' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "سند خروجی" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Treasury -->
      {% if user_feature_permissions|feature_allowed:'accounting.treasury.expense' or user_feature_permissions|feature_allowed:'accounting.treasury.income' or user_feature_permissions|feature_allowed:'accounting.treasury.accounts' or user_feature_permissions|feature_allowed:'accounting.treasury.transactions' or user_feature_permissions|feature_allowed:'accounting.treasury.checks' or user_feature_permissions|feature_allowed:'accounting.treasury.reconciliation' or request.user.is_superuser %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="accounting-treasury">
            <span>{% trans "خزانه" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="accounting-treasury">
            {% if user_feature_permissions|feature_allowed:'accounting.treasury.expense' or request.user.is_superuser %}
              <a href="{% url 'accounting:treasury_expense' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "سند هزینه" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.treasury.income' or request.user.is_superuser %}
              <a href="{% url 'accounting:treasury_income' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "سند درآمد" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.treasury.accounts' or request.user.is_superuser %}
              <a href="{% url 'accounting:treasury_accounts' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "حساب‌های نقدی و بانکی" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.treasury.transactions' or request.user.is_superuser %}
              <a href="{% url 'accounting:treasury_transactions' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "تراکنش‌های خزانه" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.treasury.checks' or request.user.is_superuser %}
              <a href="{% url 'accounting:treasury_checks' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "مدیریت چک‌ها" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.treasury.reconciliation' or request.user.is_superuser %}
              <a href="{% url 'accounting:treasury_reconciliation' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "تطبیق بانکی" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Income & Expense -->
      {% if user_feature_permissions|feature_allowed:'accounting.income_expense.income' or user_feature_permissions|feature_allowed:'accounting.income_expense.expense' or user_feature_permissions|feature_allowed:'accounting.income_expense.categories' or user_feature_permissions|feature_allowed:'accounting.income_expense.cost_centers' or request.user.is_superuser %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="accounting-income-expense">
            <span>{% trans "درآمد و هزینه" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="accounting-income-expense">
            {% if user_feature_permissions|feature_allowed:'accounting.income_expense.income' or request.user.is_superuser %}
              <a href="{% url 'accounting:income_expense_income' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "ثبت درآمد" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.income_expense.expense' or request.user.is_superuser %}
              <a href="{% url 'accounting:income_expense_expense' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "ثبت هزینه" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.income_expense.categories' or request.user.is_superuser %}
              <a href="{% url 'accounting:income_expense_categories' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "دسته‌بندی درآمد و هزینه" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.income_expense.cost_centers' or request.user.is_superuser %}
              <a href="{% url 'accounting:cost_centers' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "مرکز هزینه" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Party Accounts -->
      {% if user_feature_permissions|feature_allowed:'accounting.parties.list' or user_feature_permissions|feature_allowed:'accounting.parties.accounts' or user_feature_permissions|feature_allowed:'accounting.parties.transactions' or request.user.is_superuser %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="accounting-parties">
            <span>{% trans "طرف حساب‌ها" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="accounting-parties">
            {% if user_feature_permissions|feature_allowed:'accounting.parties.list' or request.user.is_superuser %}
              <a href="{% url 'accounting:parties' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "طرف حساب‌ها" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.parties.accounts' or request.user.is_superuser %}
              <a href="{% url 'accounting:party_accounts' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "حساب‌های طرف حساب" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.parties.transactions' or request.user.is_superuser %}
              <a href="{% url 'accounting:party_transactions' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "تراکنش‌های طرف حساب" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Payroll -->
      {% if user_feature_permissions|feature_allowed:'accounting.payroll.payment' or user_feature_permissions|feature_allowed:'accounting.payroll.insurance_tax' or user_feature_permissions|feature_allowed:'accounting.payroll.document' or user_feature_permissions|feature_allowed:'accounting.payroll.bank_transfer' or request.user.is_superuser %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="accounting-payroll">
            <span>{% trans "Payroll" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="accounting-payroll">
            {% if user_feature_permissions|feature_allowed:'accounting.payroll.payment' or request.user.is_superuser %}
              <a href="{% url 'accounting:payroll_payment' %}" class="nav-link-sub">{% trans "پرداخت حقوق و دستمزد" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.payroll.insurance_tax' or request.user.is_superuser %}
              <a href="{% url 'accounting:payroll_insurance_tax' %}" class="nav-link-sub">{% trans "تنظیمات بیمه و مالیات" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.payroll.document' or request.user.is_superuser %}
              <a href="{% url 'accounting:payroll_document' %}" class="nav-link-sub">{% trans "بارگذاری اسناد حقوق و دستمزد" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.payroll.bank_transfer' or request.user.is_superuser %}
              <a href="{% url 'accounting:payroll_bank_transfer' %}" class="nav-link-sub">{% trans "خروجی حقوق و دستمزد برای بانک" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Tax Compliance -->
      {% if user_feature_permissions|feature_allowed:'accounting.tax.vat' or user_feature_permissions|feature_allowed:'accounting.tax.ttms' or user_feature_permissions|feature_allowed:'accounting.tax.seasonal' or request.user.is_superuser %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="accounting-tax">
            <span>{% trans "مالیات" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="accounting-tax">
            {% if user_feature_permissions|feature_allowed:'accounting.tax.vat' or request.user.is_superuser %}
              <a href="{% url 'accounting:tax_vat' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "مدیریت VAT" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.tax.ttms' or request.user.is_superuser %}
              <a href="{% url 'accounting:tax_ttms' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "TTMS" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.tax.seasonal' or request.user.is_superuser %}
              <a href="{% url 'accounting:tax_seasonal' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "گزارش فصلی" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Financial Reports -->
      {% if user_feature_permissions|feature_allowed:'accounting.reports.balance_sheet' or user_feature_permissions|feature_allowed:'accounting.reports.income_statement' or user_feature_permissions|feature_allowed:'accounting.reports.account_movements' or user_feature_permissions|feature_allowed:'accounting.reports.trial_balance' or user_feature_permissions|feature_allowed:'accounting.reports.party_statement' or user_feature_permissions|feature_allowed:'accounting.reports.vat' or request.user.is_superuser %}
        <div class="nav-group">
          <button type="button" class="nav-group-header" data-submenu="accounting-reports">
            <span>{% trans "گزارش‌های مالی" %}</span>
            <span class="nav-group-icon">▼</span>
          </button>
          <div class="nav-group-content" id="accounting-reports">
            {% if user_feature_permissions|feature_allowed:'accounting.reports.balance_sheet' or request.user.is_superuser %}
              <a href="{% url 'accounting:report_balance_sheet' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "ترازنامه" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.reports.income_statement' or request.user.is_superuser %}
              <a href="{% url 'accounting:report_income_statement' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "صورت سود و زیان" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.reports.account_movements' or request.user.is_superuser %}
              <a href="{% url 'accounting:report_account_movements' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "گردش حساب" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.reports.trial_balance' or request.user.is_superuser %}
              <a href="{% url 'accounting:report_trial_balance' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "تراز آزمایشی" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.reports.party_statement' or request.user.is_superuser %}
              <a href="{% url 'accounting:report_party_statement' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "گزارش تفصیلی طرف حساب" %}</a>
            {% endif %}
            {% if user_feature_permissions|feature_allowed:'accounting.reports.vat' or request.user.is_superuser %}
              <a href="{% url 'accounting:report_vat' %}" class="nav-link-sub" onclick="event.stopPropagation();">{% trans "گزارش VAT" %}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Settings -->
      {% if user_feature_permissions|feature_allowed:'accounting.settings' or request.user.is_superuser %}
        <a href="{% url 'accounting:settings' %}" class="nav-link">{% trans "تنظیمات" %}</a>
      {% endif %}
    </div>
  </div>

  <!-- Sales Section -->
  <div class="sidebar-section" data-section="sales">
    <button type="button" class="section-header" data-target="sales">
      <span class="section-title">{% trans "Sales" %}</span>
      <span class="section-icon">▼</span>
    </button>
    <div class="section-content" id="sales">
      <a href="{% url 'sales:dashboard' %}" class="nav-link">{% trans "Dashboard" %}</a>
      <a href="{% url 'sales:invoice_create' %}" class="nav-link">{% trans "Create Sales Invoice" %}</a>
    </div>
  </div>

  <!-- HR Section -->
  <div class="sidebar-section" data-section="hr">
    <button type="button" class="section-header" data-target="hr">
      <span class="section-title">{% trans "Human Resources" %}</span>
      <span class="section-icon">▼</span>
    </button>
    <div class="section-content" id="hr">
      <a href="{% url 'hr:dashboard' %}" class="nav-link">{% trans "Dashboard" %}</a>
      
      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="hr-personnel">
          <span>{% trans "Personnel" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="hr-personnel">
          <a href="{% url 'hr:personnel_create' %}" class="nav-link-sub">{% trans "Create Personnel" %}</a>
          <a href="{% url 'hr:personnel_decree_assignment' %}" class="nav-link-sub">{% trans "Decree Assignment" %}</a>
          <a href="{% url 'hr:personnel_form_create' %}" class="nav-link-sub">{% trans "Create Personnel Form" %}</a>
          <a href="{% url 'hr:personnel_form_groups' %}" class="nav-link-sub">{% trans "Personnel Form Groups" %}</a>
          <a href="{% url 'hr:personnel_form_subgroups' %}" class="nav-link-sub">{% trans "Personnel Form Sub-Groups" %}</a>
        </div>
      </div>

      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="hr-payroll-decrees">
          <span>{% trans "حکم‌های حقوق و دستمزد" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="hr-payroll-decrees">
          <a href="{% url 'hr:payroll_decrees' %}" class="nav-link-sub">{% trans "حکم‌ها" %}</a>
          <a href="{% url 'hr:payroll_decree_groups' %}" class="nav-link-sub">{% trans "گروه‌بندی حکم‌ها" %}</a>
          <a href="{% url 'hr:payroll_decree_subgroups' %}" class="nav-link-sub">{% trans "زیر گروه‌بندی حکم‌ها" %}</a>
        </div>
      </div>

      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="hr-requests">
          <span>{% trans "Requests" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="hr-requests">
          <a href="{% url 'hr:requests_leave' %}" class="nav-link-sub">{% trans "Leave Request" %}</a>
          <a href="{% url 'hr:requests_sick_leave' %}" class="nav-link-sub">{% trans "Sick Leave Request" %}</a>
          <a href="{% url 'hr:requests_loan' %}" class="nav-link-sub">{% trans "Loan Request" %}</a>
        </div>
      </div>

      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="hr-loans">
          <span>{% trans "Loans" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="hr-loans">
          <a href="{% url 'hr:loans_management' %}" class="nav-link-sub">{% trans "Loan Management" %}</a>
          <a href="{% url 'hr:loans_scheduling' %}" class="nav-link-sub">{% trans "Loan Scheduling" %}</a>
          <a href="{% url 'hr:loans_savings_fund' %}" class="nav-link-sub">{% trans "Savings Fund" %}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Office Automation Section -->
  <div class="sidebar-section" data-section="office_automation">
    <button type="button" class="section-header" data-target="office_automation">
      <span class="section-title">{% trans "Office Automation" %}</span>
      <span class="section-icon">▼</span>
    </button>
    <div class="section-content" id="office_automation">
      <a href="{% url 'office_automation:dashboard' %}" class="nav-link">{% trans "Dashboard" %}</a>
      
      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="office-automation-inbox">
          <span>{% trans "Inbox" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="office-automation-inbox">
          <a href="{% url 'office_automation:inbox_incoming' %}" class="nav-link-sub">{% trans "Incoming Letters" %}</a>
          <a href="{% url 'office_automation:inbox_write' %}" class="nav-link-sub">{% trans "Write Letter" %}</a>
          <a href="{% url 'office_automation:inbox_fill_form' %}" class="nav-link-sub">{% trans "Fill Form" %}</a>
        </div>
      </div>

      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="office-automation-processes">
          <span>{% trans "Processes" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="office-automation-processes">
          <a href="{% url 'office_automation:processes_engine' %}" class="nav-link-sub">{% trans "Process Engine" %}</a>
          <a href="{% url 'office_automation:processes_form_connection' %}" class="nav-link-sub">{% trans "Process-Form Connection" %}</a>
        </div>
      </div>

      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="office-automation-forms">
          <span>{% trans "Forms" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="office-automation-forms">
          <a href="{% url 'office_automation:forms_builder' %}" class="nav-link-sub">{% trans "Form Builder" %}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Transportation Section -->
  <div class="sidebar-section" data-section="transportation">
    <button type="button" class="section-header" data-target="transportation">
      <span class="section-title">{% trans "Transportation" %}</span>
      <span class="section-icon">▼</span>
    </button>
    <div class="section-content" id="transportation">
      <a href="{% url 'transportation:dashboard' %}" class="nav-link">{% trans "Dashboard" %}</a>
    </div>
  </div>

  <!-- Procurement Section -->
  <div class="sidebar-section" data-section="procurement">
    <button type="button" class="section-header" data-target="procurement">
      <span class="section-title">{% trans "Procurement" %}</span>
      <span class="section-icon">▼</span>
    </button>
    <div class="section-content" id="procurement">
      <a href="{% url 'procurement:dashboard' %}" class="nav-link">{% trans "Dashboard" %}</a>
      
      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="procurement-purchase">
          <span>{% trans "Purchase" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="procurement-purchase">
          <a href="{% url 'procurement:purchases' %}" class="nav-link-sub">{% trans "Purchases" %}</a>
        </div>
      </div>

      <div class="nav-group">
        <button type="button" class="nav-group-header" data-submenu="procurement-buyers">
          <span>{% trans "Buyers" %}</span>
          <span class="nav-group-icon">▼</span>
        </button>
        <div class="nav-group-content" id="procurement-buyers">
          <a href="{% url 'procurement:buyers' %}" class="nav-link-sub">{% trans "Buyers List" %}</a>
          <a href="{% url 'procurement:buyer_create' %}" class="nav-link-sub">{% trans "Create Buyer" %}</a>
          <a href="{% url 'procurement:buyer_assignment' %}" class="nav-link-sub">{% trans "Buyer Assignment" %}</a>
        </div>
      </div>
    </div>
  </div>
</nav>

